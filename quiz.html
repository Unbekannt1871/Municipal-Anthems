<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªæ²»ä½“æ­Œã‚¯ã‚¤ã‚º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      color: #333;
      padding: 2rem;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #cc5500;
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2em;
    }

    .setup-area {
      text-align: center;
    }

    .category-select {
      margin-bottom: 30px;
    }

    .category-title, .mode-title {
      color: #994400;
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 1rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.3rem;
    }

    .category-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .category-block {
      flex: 0 0 auto;
      background-color: #f0f0f0;
      color: #666;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      border: 2px solid #ddd;
    }

    .category-block:hover {
      background-color: #e6e6e6;
      border-color: #bbb;
    }

    .category-block.selected {
      background-color: #ffe6cc;
      color: #cc5500;
      border-color: #ff9933;
    }

    // å‰Šé™¤ã•ã‚ŒãŸéƒ¨åˆ†ï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ã®ã‚¯ãƒ©ã‚¹å®šç¾©ï¼‰
    

    .select-all-btn {
      background-color: #e6e6e6;
      color: #333;
      border: 1px solid #ccc;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }

    .select-all-btn:hover {
      background-color: #d9d9d9;
    }

    .mode-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .mode-btn {
      background: linear-gradient(45deg, #16a085, #1abc9c);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      min-width: 140px;
    }

    .mode-btn:hover {
      background: linear-gradient(45deg, #138d75, #17a2b8);
    }

    .mode-btn.selected {
      background: linear-gradient(45deg, #e74c3c, #c0392b);
    }

    .mode-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .start-btn {
      background-color: #ff6600;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
      transition: all 0.3s ease;
      margin-top: 1.5rem;
    }

    .start-btn:hover {
      background-color: #e55a00;
    }

    .start-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    #quiz-area {
      text-align: center;
      display: none;
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .progress-info, .score {
      font-size: 1em;
      font-weight: bold;
      color: #994400;
    }

    .lyrics-display {
      background: #fafafa;
      border-radius: 6px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-left: 4px solid #ff6600;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .lyrics-text {
      font-size: 1.1em;
      line-height: 1.6;
      color: #333;
      white-space: pre-line;
    }

    .answer-input {
      width: 100%;
      max-width: 400px;
      padding: 0.8rem;
      font-size: 1em;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .answer-input:focus {
      border-color: #ff6600;
    }

    .submit-btn {
      background-color: #ff6600;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .submit-btn:hover {
      background-color: #e55a00;
    }

    .submit-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .feedback {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 6px;
      font-weight: bold;
      display: none;
    }

    .feedback.correct {
      background: #e8f5e8;
      color: #2d5a2d;
      border: 1px solid #4caf50;
      display: block;
    }

    .feedback.incorrect {
      background: #ffeaea;
      color: #d32f2f;
      border: 1px solid #f44336;
      display: block;
    }

    .next-btn, .restart-btn {
      background-color: #ff9933;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .next-btn:hover, .restart-btn:hover {
      background-color: #e6881a;
    }

    .result-area {
      display: none;
      text-align: center;
      padding: 2rem;
      background: #fafafa;
      border-radius: 6px;
      margin-top: 1.5rem;
      border: 1px solid #ddd;
    }

    .result-title {
      font-size: 1.5em;
      color: #cc5500;
      margin-bottom: 1rem;
    }

    .result-score {
      font-size: 1.2em;
      color: #994400;
      margin-bottom: 1rem;
    }

    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .category-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .mode-buttons {
        flex-direction: column;
      }
      
      .quiz-header {
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸµ è‡ªæ²»ä½“æ­Œã‚¯ã‚¤ã‚º ğŸµ</h1>
    
    <div class="setup-area">
      <!-- åˆ¶åº¦åŒºåˆ†ã®é¸æŠ -->
      <div class="category-select">
        <div class="category-title">å‡ºé¡Œã™ã‚‹è‡ªæ²»ä½“ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        <div class="category-grid">
          <div class="category-block prefecture" data-type="prefecture">éƒ½é“åºœçœŒ</div>
          <div class="category-block city" data-type="city">å¸‚</div>
          <div class="category-block ward" data-type="ward">åŒº</div>
          <div class="category-block town" data-type="town">ç”º</div>
          <div class="category-block village" data-type="village">æ‘</div>
          <div class="category-block abolished" data-type="abolished">å»ƒæ­¢</div>
        </div>
        <button class="select-all-btn" id="selectAll">ã™ã¹ã¦é¸æŠ / è§£é™¤</button>
      </div>

      <!-- å‡ºé¡Œãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ -->
      <div class="mode-select">
        <div class="mode-title">å‡ºé¡Œãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        <div class="mode-buttons">
          <button class="mode-btn" id="mode-10" data-mode="10">10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
          <button class="mode-btn" id="mode-20" data-mode="20">20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
          <button class="mode-btn" id="mode-endless" data-mode="endless">ä¸æ­£è§£ã¾ã§ç¶™ç¶š</button>
        </div>
      </div>

      <button class="start-btn" id="startQuiz" disabled>ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã™ã‚‹</button>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºæœ¬ä½“ -->
    <div id="quiz-area">
      <div class="quiz-header">
        <div class="progress-info">
          <span id="current-question">1</span> / <span id="total-questions">20</span>
        </div>
        <div class="score">æ­£è§£æ•°: <span id="correct-count">0</span></div>
      </div>
      
      
      <div class="hint-section">
        <div class="hint-title">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</div>
        <div class="hint-info">
          <div class="hint-item">æ­£å¼åç§°: <span id="formal-length">0</span>æ–‡å­—</div>
          <div class="hint-item">ã²ã‚‰ãŒãª: <span id="hiragana-length">0</span>æ–‡å­—</div>
        </div>
      </div>
      
      <div class="lyrics-display">
        <div class="lyrics-text" id="lyrics">ã“ã“ã«æ­Œè©ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
      </div>
      
      <div class="answer-section">
        <input type="text" class="answer-input" id="answer" placeholder="è‡ªæ²»ä½“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šæ±äº¬éƒ½ã€å¤§é˜ªå¸‚ï¼‰">
        <br>
        <button class="submit-btn" id="submit">å›ç­”ã™ã‚‹</button>
      </div>
      
      <div class="feedback" id="feedback"></div>
      
      <button class="next-btn" id="nextBtn" style="display:none;">æ¬¡ã®å•é¡Œ</button>
    </div>

    <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="result-area" id="result-area">
      <div class="result-title">ğŸ‰ ã‚¯ã‚¤ã‚ºçµ‚äº†ï¼ ğŸ‰</div>
      <div class="result-score" id="final-score"></div>
      <button class="restart-btn" id="restartBtn">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹</button>
    </div>
  </div>

  <script>
    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
    const sampleData = [
      {
        lyrics: "æ•…éƒ·ã®å±±æ²³ã€€ç¾ã—ã\né¢¨å…‰æ˜åªšãªã€€ã“ã®åœŸåœ°ã«\nå¸Œæœ›ã‚’èƒ¸ã«ã€€æ­©ã¿è¡Œã",
        answer: "å±±æ¢¨çœŒ",
        hiragana: "ã‚„ã¾ãªã—ã‘ã‚“",
        formalLength: 3,
        hiraganaLength: 6,
        type: "prefecture"
      },
      {
        lyrics: "é’ã„ç©ºã«ã€€ç™½ã„é›²\nç·‘è±Šã‹ãªã€€ç”°åœ’é¢¨æ™¯\nå¿ƒã‚‚è»½ã‚„ã‹ã€€æ­Œå£°éŸ¿ã",
        answer: "é•·é‡å¸‚",
        hiragana: "ãªãŒã®ã—",
        formalLength: 3,
        hiraganaLength: 4,
        type: "city"
      },
      {
        lyrics: "æµ·ã®å‘ã“ã†ã«ã€€å¤¢ã‚’è¦‹ã¦\næ¸¯ç”ºã®ã€€é˜ãŒé³´ã‚‹\nä»Šæ—¥ã‚‚æ˜æ—¥ã‚‚ã€€é ‘å¼µã‚ã†",
        answer: "æ¨ªæµœå¸‚",
        hiragana: "ã‚ˆã“ã¯ã¾ã—",
        formalLength: 3,
        hiraganaLength: 5,
        type: "city"
      },
      {
        lyrics: "æ¡œå’²ãé“ã€€æ­©ããªãŒã‚‰\næ–°ã—ã„å­£ç¯€ã€€è¿ãˆã‚ˆã†\nã¿ã‚“ãªã§ä½œã‚‹ã€€æ˜ã‚‹ã„æœªæ¥",
        answer: "å¤§é˜ªåºœ",
        hiragana: "ãŠãŠã•ã‹ãµ",
        formalLength: 3,
        hiraganaLength: 5,
        type: "prefecture"
      },
      {
        lyrics: "å±±ä¸¦ã¿é ãã€€ç©ºé«˜ã\næ¸…ã‚‰ã‹ãªæ°´ã€€æµã‚Œã‚†ã\nè‡ªç„¶ã¨å…±ã«ã€€ç”Ÿãã¦ã„ã“ã†",
        answer: "å²é˜œçœŒ",
        hiragana: "ããµã‘ã‚“",
        formalLength: 3,
        hiraganaLength: 4,
        type: "prefecture"
      }
    ];

    let selectedCategories = [];
    let selectedMode = null;
    let currentQuiz = [];
    let currentQuestionIndex = 0;
    let correctCount = 0;
    let totalQuestions = 0;

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initializeEventListeners();
    });

    function initializeEventListeners() {
      // ã‚«ãƒ†ã‚´ãƒªé¸æŠ
      document.querySelectorAll('.category-block').forEach(block => {
        block.addEventListener('click', function() {
          toggleCategory(this.dataset.type, this);
        });
      });

      // å…¨é¸æŠãƒœã‚¿ãƒ³
      document.getElementById('selectAll').addEventListener('click', toggleAllCategories);

      // ãƒ¢ãƒ¼ãƒ‰é¸æŠ
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          selectMode(this.dataset.mode, this);
        });
      });

      // ã‚¯ã‚¤ã‚ºé–‹å§‹
      document.getElementById('startQuiz').addEventListener('click', startQuiz);

      // å›ç­”é€ä¿¡
      document.getElementById('submit').addEventListener('click', submitAnswer);
      
      // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ã‚‚é€ä¿¡
      document.getElementById('answer').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          submitAnswer();
        }
      });

      // æ¬¡ã®å•é¡Œ
      document.getElementById('nextBtn').addEventListener('click', nextQuestion);

      // ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
      document.getElementById('restartBtn').addEventListener('click', restartQuiz);
    }

    function toggleCategory(type, element) {
      const index = selectedCategories.indexOf(type);
      if (index > -1) {
        selectedCategories.splice(index, 1);
        element.classList.remove('selected');
      } else {
        selectedCategories.push(type);
        element.classList.add('selected');
      }
      updateStartButton();
    }

    function toggleAllCategories() {
      const blocks = document.querySelectorAll('.category-block');
      if (selectedCategories.length === blocks.length) {
        // å…¨è§£é™¤
        selectedCategories = [];
        blocks.forEach(block => block.classList.remove('selected'));
      } else {
        // å…¨é¸æŠ
        selectedCategories = [];
        blocks.forEach(block => {
          selectedCategories.push(block.dataset.type);
          block.classList.add('selected');
        });
      }
      updateStartButton();
    }

    function selectMode(mode, element) {
      selectedMode = mode;
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.style.background = 'linear-gradient(45deg, #16a085, #1abc9c)';
      });
              element.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
      updateStartButton();
    }

    function updateStartButton() {
      const startBtn = document.getElementById('startQuiz');
      if (selectedCategories.length > 0 && selectedMode) {
        startBtn.disabled = false;
      } else {
        startBtn.disabled = true;
      }
    }

    function startQuiz() {
      // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      currentQuiz = sampleData.filter(item => selectedCategories.includes(item.type));
      
      if (currentQuiz.length === 0) {
        alert('é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      currentQuiz = shuffleArray([...currentQuiz]);

      // å•é¡Œæ•°ã‚’è¨­å®š
      if (selectedMode === 'endless') {
        totalQuestions = currentQuiz.length;
        document.getElementById('total-questions').textContent = 'âˆ';
      } else {
        totalQuestions = Math.min(parseInt(selectedMode), currentQuiz.length);
        currentQuiz = currentQuiz.slice(0, totalQuestions);
        document.getElementById('total-questions').textContent = totalQuestions;
      }

      currentQuestionIndex = 0;
      correctCount = 0;

      // UIåˆ‡ã‚Šæ›¿ãˆ
      document.querySelector('.setup-area').style.display = 'none';
      document.getElementById('quiz-area').style.display = 'block';

      showQuestion();
    }

    function showQuestion() {
      const question = currentQuiz[currentQuestionIndex];
      document.getElementById('lyrics').textContent = question.lyrics;
      document.getElementById('formal-length').textContent = question.formalLength;
      document.getElementById('hiragana-length').textContent = question.hiraganaLength;
      document.getElementById('answer').value = '';
      document.getElementById('answer').focus();
      document.getElementById('submit').disabled = false;
      document.getElementById('feedback').style.display = 'none';
      document.getElementById('nextBtn').style.display = 'none';
      
      // é€²è¡ŒçŠ¶æ³ã‚’æ›´æ–°
      if (selectedMode !== 'endless') {
        document.getElementById('current-question').textContent = currentQuestionIndex + 1;
      } else {
        document.getElementById('current-question').textContent = currentQuestionIndex + 1;
      }
      document.getElementById('correct-count').textContent = correctCount;
    }

    function submitAnswer() {
      const userAnswer = document.getElementById('answer').value.trim();
      const correctAnswer = currentQuiz[currentQuestionIndex].answer;
      const feedback = document.getElementById('feedback');

      document.getElementById('submit').disabled = true;

      if (userAnswer === correctAnswer || 
          userAnswer === correctAnswer.replace(/[éƒ½é“åºœçœŒå¸‚åŒºç”ºæ‘]/g, '') ||
          userAnswer === currentQuiz[currentQuestionIndex].hiragana) {
        // æ­£è§£
        correctCount++;
        feedback.className = 'feedback correct';
        feedback.textContent = `ğŸ‰ æ­£è§£ï¼ ç­”ãˆ: ${correctAnswer}`;
        feedback.style.display = 'block';
        
        // æ¬¡ã®å•é¡Œã¸
        setTimeout(() => {
          currentQuestionIndex++;
          if (currentQuestionIndex < currentQuiz.length && 
              (selectedMode === 'endless' || currentQuestionIndex < totalQuestions)) {
            showQuestion();
          } else {
            showResult();
          }
        }, 2000);
      } else {
        // ä¸æ­£è§£
        feedback.className = 'feedback incorrect';
        feedback.textContent = `âŒ ä¸æ­£è§£... æ­£è§£ã¯: ${correctAnswer}`;
        feedback.style.display = 'block';

        if (selectedMode === 'endless') {
          // ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¯ä¸æ­£è§£ã§çµ‚äº†
          setTimeout(showResult, 2000);
        } else {
          // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
          document.getElementById('nextBtn').style.display = 'inline-block';
        }
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < totalQuestions) {
        showQuestion();
      } else {
        showResult();
      }
